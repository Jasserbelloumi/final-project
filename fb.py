import telebot
import time
import os
import random
from selenium import webdriver
from selenium.webdriver.chrome.options import Options
from selenium.webdriver.common.by import By

TOKEN = "7665591962:AAFIIe-izSG4rd71Kruf0xmXM9j11IYdHvc"
bot = telebot.TeleBot(TOKEN)

def send_file(chat_id, driver, caption):
    try:
        path = f"ios_step_{int(time.time())}.png"
        driver.save_screenshot(path)
        with open(path, "rb") as f:
            bot.send_document(chat_id, f, caption=caption)
        time.sleep(1)
        if os.path.exists(path): os.remove(path)
    except: pass

@bot.message_handler(commands=['start'])
def start(message):
    bot.send_message(message.chat.id, "ğŸ ØªÙ… ØªÙØ¹ÙŠÙ„ Ù†Ù…Ø· iPhone 14 Pro - Chrome.\nØ¬Ø§Ø±ÙŠ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø°ÙƒÙˆØ±...")
    # ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø°ÙŠ Ø²ÙˆØ¯ØªÙ†ÙŠ Ø¨Ù‡
    process_login(message, "61583389620613", "jasser vodka")

def process_login(message, uid, pas):
    bot.send_message(message.chat.id, "âŒ› Ø¬Ø§Ø±ÙŠ Ù…Ø­Ø§ÙƒØ§Ø© Ø¨ØµÙ…Ø© Ø§Ù„Ø¬Ù‡Ø§Ø² ÙˆØªØ®Ø·ÙŠ Ø§Ù„Ø£Ù†Ø¸Ù…Ø©...")
    
    opts = Options()
    opts.add_argument("--headless")
    opts.add_argument("--no-sandbox")
    opts.add_argument("--disable-dev-shm-usage")
    
    # --- Ø¨ØµÙ…Ø© Ø¢ÙŠÙÙˆÙ† 14 Ø¨Ø±Ùˆ Ù…Ø§ÙƒØ³ (Ù…ØªØµÙØ­ ÙƒØ±ÙˆÙ…) ---
    user_agent = "Mozilla/5.0 (iPhone; CPU iPhone OS 16_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) CriOS/114.0.5735.99 Mobile/15E148 Safari/604.1"
    opts.add_argument(f'user-agent={user_agent}')
    
    # Ø¥Ø®ÙØ§Ø¡ Ù…Ù„Ø§Ù…Ø­ Ø§Ù„Ø£ØªÙ…ØªØ©
    opts.add_argument("--disable-blink-features=AutomationControlled")
    opts.add_experimental_option("excludeSwitches", ["enable-automation"])
    opts.add_experimental_option('useAutomationExtension', False)
    
    driver = webdriver.Chrome(options=opts)
    
    # Ø¥ÙŠÙ‡Ø§Ù… Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø£Ù†Ùƒ Ù„Ø³Øª "Ø¯Ø±Ø§ÛŒÙØ±"
    driver.execute_script("Object.defineProperty(navigator, 'webdriver', {get: () => undefined})")

    try:
        driver.get("https://m.facebook.com/login/")
        time.sleep(random.uniform(3, 5))
        send_file(message.chat.id, driver, "ğŸ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¢ÙŠÙÙˆÙ† - ØµÙØ­Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„")

        # Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¨Ø´Ø±ÙŠØ©
        email_input = driver.find_element(By.NAME, "email")
        for char in uid:
            email_input.send_keys(char)
            time.sleep(random.uniform(0.1, 0.2))

        pass_input = driver.find_element(By.NAME, "pass")
        for char in pas:
            pass_input.send_keys(char)
            time.sleep(random.uniform(0.1, 0.2))

        send_file(message.chat.id, driver, "ğŸ“ Ø¨Ø¹Ø¯ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù†Ù…Ø· Ø¢ÙŠÙÙˆÙ†)")

        # Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø±Ù† Ø¹Ù† Ø²Ø± Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„ØªØ¬Ù†Ø¨ Ø®Ø·Ø£ No such element
        bot.send_message(message.chat.id, "ğŸ”˜ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ù†Ù‚Ø± Ø§Ù„Ø°ÙƒÙŠ...")
        try:
            # Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø§Ù„Ø§Ø³Ù…
            login_btn = driver.find_element(By.NAME, "login")
            driver.execute_script("arguments[0].click();", login_btn)
        except:
            # Ù…Ø­Ø§ÙˆÙ„Ø© Ø¹Ø¨Ø± XPATH Ø´Ø§Ù…Ù„ Ù„Ø£ÙŠ Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„
            driver.execute_script("document.querySelector('button[type=\"submit\"], input[type=\"submit\"]').click();")
        
        time.sleep(12) # Ø§Ù†ØªØ¸Ø§Ø± ÙƒØ§ÙÙ Ù„Ù„ØªØ­Ù…ÙŠÙ„
        
        final_url = driver.current_url
        bot.send_message(message.chat.id, f"ğŸ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:\nğŸ”— {final_url}")
        send_file(message.chat.id, driver, "ğŸ“Š Ù„Ù‚Ø·Ø© Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©")

    except Exception as e:
        bot.send_message(message.chat.id, f"âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: {str(e)[:100]}")
        send_file(message.chat.id, driver, "ğŸ“¸ Ù„Ù‚Ø·Ø© Ù„Ø­Ø¸Ø© Ø§Ù„Ø®Ø·Ø£")
    finally:
        driver.quit()

bot.infinity_polling()
